#!/bin/bash
# Pre-push hook for NovaChat
# Runs unit tests before push to ensure code quality

set -e

echo "ğŸš€ Running pre-push checks..."

# Check if app directory exists
if [ ! -d "app" ]; then
    echo "âœ… No app directory found, skipping checks"
    exit 0
fi

# Check if gradlew exists
if [ ! -f "gradlew" ]; then
    echo "âš ï¸  gradlew not found, skipping checks"
    exit 0
fi

# Make gradlew executable
chmod +x gradlew

# Get the current branch
CURRENT_BRANCH=$(git symbolic-ref --short HEAD)

echo "ğŸ“¦ Current branch: $CURRENT_BRANCH"

# Run unit tests
echo ""
echo "ğŸ§ª Running unit tests..."
if ./gradlew testDebugUnitTest --no-daemon --quiet 2>&1 | tail -20; then
    echo "âœ… Unit tests passed"
else
    echo "âŒ Unit tests failed! Please fix the tests before pushing."
    echo ""
    echo "To bypass this check (not recommended), use:"
    echo "  git push --no-verify"
    exit 1
fi

# Run lint checks (optional, can be slow)
# echo ""
# echo "ğŸ” Running lint checks..."
# if ./gradlew lintDebug --no-daemon --quiet; then
#     echo "âœ… Lint checks passed"
# else
#     echo "âš ï¸  Lint checks found issues, but allowing push"
# fi

echo ""
echo "âœ… Pre-push checks completed successfully!"
echo "ğŸ‰ Ready to push!"
exit 0
